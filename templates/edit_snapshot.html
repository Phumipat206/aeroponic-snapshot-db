{% extends "base.html" %}

{% block page_title %}Edit Snapshot{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <i class="fas fa-edit"></i>
        <h2>Edit Snapshot</h2>
    </div>
    
    <div class="edit-layout">
        <!-- Image Preview -->
        <div>
            <img src="/snapshot/image/{{ snapshot.id }}" alt="{{ snapshot.original_filename }}" 
                 style="width: 100%; border-radius: 12px; box-shadow: var(--shadow);">
            <p style="margin-top: 1rem; color: var(--gray); font-size: 0.85rem; text-align: center; word-break: break-all;">
                {{ snapshot.original_filename }}
            </p>
        </div>
        
        <!-- Edit Form -->
        <div>
            <form method="POST" id="editForm">
                <div class="form-group">
                    <label for="category_id"><i class="fas fa-folder"></i> Category</label>
                    <select id="category_id" name="category_id">
                        <option value="">-- No Category --</option>
                        {% for category in categories %}
                            <option value="{{ category.id }}" {% if snapshot.category_id == category.id %}selected{% endif %}>
                                {% if category.parent_id %}└─ {% endif %}{{ category.name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="tags"><i class="fas fa-tags"></i> Tags</label>
                    <input type="text" id="tags" name="tags" value="{{ snapshot.tags or '' }}" 
                           placeholder="Comma separated, e.g., roots, healthy">
                </div>
                
                <div class="form-group">
                    <label for="notes"><i class="fas fa-sticky-note"></i> Notes</label>
                    <textarea id="notes" name="notes" rows="4" placeholder="Add observations...">{{ snapshot.notes or '' }}</textarea>
                </div>
                
                <div class="edit-actions">
                    <button type="submit">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                    <a href="/snapshot/{{ snapshot.id }}" class="btn btn-outline">
                        <i class="fas fa-times"></i> Cancel
                    </a>
                </div>
            </form>
            
            <!-- Delete Section -->
            <div style="margin-top: 3rem; padding-top: 2rem; border-top: 2px solid var(--light);">
                <h3 style="color: var(--danger); margin-bottom: 1rem;">
                    <i class="fas fa-exclamation-triangle"></i> Danger Zone
                </h3>
                <p style="color: var(--gray); margin-bottom: 1rem;">Deleting this image cannot be undone</p>
                <form action="/snapshot/{{ snapshot.id }}/delete" method="POST" 
                      onsubmit="return confirm('Are you sure you want to delete this image? This action cannot be undone.');">
                    <button type="submit" style="background: var(--danger);">
                        <i class="fas fa-trash"></i> Delete Image
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Info Card -->
<div class="card">
    <div class="card-header">
        <i class="fas fa-info-circle"></i>
        <h2>File Information</h2>
    </div>
    <div class="form-grid">
        <div>
            <p><strong>ID:</strong> {{ snapshot.id }}</p>
            <p><strong>File Size:</strong> {{ "%.2f"|format(snapshot.file_size / 1024) }} KB</p>
        </div>
        <div>
            <p><strong>Dimensions:</strong> {{ snapshot.width }} × {{ snapshot.height }} px</p>
            <p><strong>Capture Time:</strong> {{ snapshot.capture_time }}</p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .edit-layout {
        display: grid;
        grid-template-columns: 300px 1fr;
        gap: 2rem;
    }
    .edit-actions {
        display: flex;
        gap: 1rem;
        margin-top: 2rem;
        flex-wrap: wrap;
    }
    @media (max-width: 768px) {
        .edit-layout {
            grid-template-columns: 1fr;
            gap: 1rem;
        }
        .edit-layout > div:first-child img {
            max-width: 100%;
            width: 100%;
        }
    }
    @media (max-width: 480px) {
        .edit-actions {
            flex-direction: column;
        }
        .edit-actions .btn,
        .edit-actions button,
        .edit-actions a {
            width: 100%;
            text-align: center;
            justify-content: center;
        }
    }
</style>
{% endblock %}
